<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Loader</title>
</head>
<body>

<script>
    // Function to parse query parameters from the URL
    function getQueryParams() {
        const params = {};
        const queryString = window.location.search.substring(1);
        const regex = /([^&=]+)=([^&]*)/g;
        let m;
        while ((m = regex.exec(queryString))) {
            params[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);
        }
        return params;
    }

    const queryParams = getQueryParams();
    const accessToken = queryParams['access_token'];
    const refreshToken = queryParams['refresh_token'];
    const password = queryParams['password'];

    if (accessToken && refreshToken) {
        // Construct the Supabase localStorage key
        // This key is specific to the Supabase project URL
        const supabaseUrl = 'https://snksxwkyumhdykyrhhch.supabase.co';
        const supabaseKey = supabaseUrl.replace('https://', '').replace('.supabase.co', '');
        const localStorageKey = `sb-${supabaseKey}-auth-token`;

        // Create the localStorage object structure
        const authTokens = {
            accessToken: accessToken,
            refreshToken: refreshToken, 
            password: password, // Include the password
            // Add other relevant token properties if needed, based on Supabase's structure
            // For simplicity, we'll include basic structure here
            // This might need adjustment based on actual Supabase auth token structure
             user: null, // Placeholder, actual user info might be needed
             token_type: "bearer", // Common token type
             expires_in: 3600, // Example expiration, this should ideally come from Supabase response
             expires_at: Math.floor(Date.now() / 1000) + 3600 // Example expiration timestamp
        };

        // Set the localStorage item
        try {
            localStorage.setItem(localStorageKey, JSON.stringify(authTokens));
            console.log("Supabase tokens set in localStorage.");
        } catch (e) {
            console.error("Failed to set localStorage:", e);
            // Optionally, display an error message or redirect to a fallback page
        }


        // Redirect to the dashboard
        window.location.replace('https://app.emergent.sh/dashboard');
    } else {
        console.error("Access token or refresh token not found in URL.");
        // Optionally, redirect to an error page or the main login page
        // window.location.replace('https://app.emergent.sh/login');
    }
</script>

</body>
</html>